<!DOCTYPE html>
<html lang="en">
<head>
  <title>Make Your Own Burger | Ultimate Burger Guide</title>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />

  <!-- Your site CSS -->
  <link rel="stylesheet" href="Style.css" />

  <!-- Theme preference -->
  <script>
    (function () {
      const theme = localStorage.getItem("theme") || "dark";
      if (theme === "light") document.documentElement.className = "light-mode";
    })();
  </script>

  <style>
    /* Keep this page stable regardless of your global Style.css */

    .builder-wrap {
      border-radius: 16px;
      overflow: hidden;
      border: 1px solid rgba(0,0,0,0.12);
      background: rgba(255,255,255,0.92);
    }

    .builder-panel {
      padding: 16px;
      height: 100%;
      background: rgba(255,255,255,0.98);
    }

    .builder-panel h4 {
      margin: 14px 0 8px;
      font-size: 1.05rem;
    }

    .builder-panel label {
      display: block;
      margin: 6px 0;
      cursor: pointer;
      user-select: none;
    }

    /* Stage */
    .stage-wrap {
      position: relative;
      height: 560px;        /* fixed stage height */
      min-height: 560px;
      width: 100%;
      overflow: hidden;
      background: radial-gradient(ellipse at top, rgba(255,255,255,0.08), rgba(0,0,0,0.85));
    }

    #threeStage {
      width: 100%;
      height: 100%;
    }

    #threeStage canvas {
      display: block;
      width: 100% !important;
      height: 100% !important;
    }

    .stage-hint {
      position: absolute;
      left: 12px;
      bottom: 12px;
      font-size: 12px;
      opacity: 0.9;
      background: rgba(0,0,0,0.55);
      color: #fff;
      border: 1px solid rgba(255,255,255,0.18);
      padding: 8px 10px;
      border-radius: 10px;
      pointer-events: none;
    }

    .stage-badge {
      position: absolute;
      right: 12px;
      top: 12px;
      font-size: 12px;
      opacity: 0.9;
      background: rgba(0,0,0,0.55);
      color: #fff;
      border: 1px solid rgba(255,255,255,0.18);
      padding: 8px 10px;
      border-radius: 10px;
      pointer-events: none;
      max-width: 60%;
    }

    #burger-recipe-output {
      margin-top: 18px;
      padding: 14px;
      border-radius: 14px;
      border: 1px solid rgba(0,0,0,0.12);
      background: rgba(255,255,255,0.96);
    }

    #build-burger-button {
      margin-top: 14px;
      font-weight: 700;
    }

    .stage-error {
      padding: 16px;
      color: #7a0012;
      background: rgba(255, 0, 0, 0.08);
      border: 1px solid rgba(255, 0, 0, 0.25);
      border-radius: 12px;
      margin: 12px;
      font-size: 14px;
      line-height: 1.4;
    }

    code {
      background: rgba(0,0,0,0.06);
      padding: 1px 6px;
      border-radius: 6px;
    }
  </style>
</head>

<body>
  <header id="main-header">
    <h1>Ultimate Burger Guide</h1>
  </header>

  <nav>
    <a href="index.html">Home</a>
    <a href="city_burgers.html">Best Burgers by City</a>
    <a href="recipe_cards.html">Recipe Cards</a>
    <a href="make_your_own.html">Make Your Own</a>
    <a href="burger_battles.html">Burger Battles</a>
    <a href="submit.html">Submit Your Pick</a>
    <a href="about.html">About</a>
  </nav>

  <main class="container my-3">
    <div class="text-center my-4">
      <h2>Interactive Burger Builder (3D)</h2>
      <p class="mb-0">
        Select ingredients on the left. The burger updates using your <b>burger-layers</b> images and auto-rotates.
      </p>

    </div>

    <div class="builder-wrap row g-0">
      <!-- LEFT -->
      <div class="col-lg-5">
        <div id="burger-builder" class="builder-panel">
          <h4>1. Pick a Bun (Required)</h4>
          <label><input type="radio" name="bun" value="brioche" checked> Brioche Bun</label>
          <label><input type="radio" name="bun" value="sesame"> Sesame Seed Bun</label>
          <label><input type="radio" name="bun" value="lettuce-wrap"> Lettuce Wrap</label>

          <h4>2. Pick a Patty (Required)</h4>
          <label><input type="radio" name="patty" value="beef" checked> Beef Patty</label>
          <label><input type="radio" name="patty" value="chicken"> Grilled Chicken</label>
          <label><input type="radio" name="patty" value="veggie"> Veggie Patty</label>

          <h4>3. Add Cheese (Optional)</h4>
          <label><input type="checkbox" name="cheese" value="american"> American Cheese</label>
          <label><input type="checkbox" name="cheese" value="cheddar"> Sharp Cheddar</label>
          <label><input type="checkbox" name="cheese" value="swiss"> Swiss Cheese</label>

          <h4>4. Add Toppings (Optional)</h4>
          <label><input type="checkbox" name="topping" value="lettuce"> Crisp Lettuce</label>
          <label><input type="checkbox" name="topping" value="tomato"> Fresh Tomato</label>
          <label><input type="checkbox" name="topping" value="onions"> Raw Onions</label>

          <button id="build-burger-button" class="btn btn-primary w-100">Build My Burger!</button>

        </div>
      </div>

      <!-- RIGHT -->
      <div class="col-lg-7">
        <div class="stage-wrap">
          <div id="threeStage">
            <div class="stage-error" style="color:#333;background:rgba(255,255,255,0.7);border-color:rgba(0,0,0,0.12);">
              Loading 3D stage…
            </div>
          </div>
          <div class="stage-hint">Auto-rotate • (Optional) drag if controls load</div>
          <div class="stage-badge" id="stageStatus">Status: Initializing…</div>
        </div>
      </div>
    </div>

    <div id="burger-recipe-output" aria-live="polite">
      <b>Your build summary will appear here.</b><br />
      Choose ingredients, then click “Build My Burger!”.
    </div>

    <hr />

    <h2 class="text-center">Our Favorite Recipe Video</h2>
    <div class="video-container">
      <iframe width="560" height="315"
        src="https://www.youtube.com/embed/mwExFzKorws?si=Hy-q9s671xEPOBfs"
        title="YouTube video player" frameborder="0"
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
        referrerpolicy="strict-origin-when-cross-origin" allowfullscreen>
      </iframe>
    </div>
  </main>

  <footer>
    <p>© 2025 Ultimate Burger Guide</p>
  </footer>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Google Translate (safe init) -->
  <div id="google_translate_element" style="display:none;"></div>
  <script>
    function googleTranslateElementInit() {
      try {
        new google.translate.TranslateElement({ pageLanguage: "en" }, "google_translate_element");
      } catch (e) {}
    }
  </script>
  <script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

  <!-- Three.js (non-module = most compatible) -->
  <script src="https://unpkg.com/three@0.160.0/build/three.min.js"></script>
  <!-- Optional controls (won't break if it fails) -->
  <script src="https://unpkg.com/three@0.160.0/examples/js/controls/OrbitControls.js"></script>

  <script>
    /***************************************************************
     * 2.5D "3D" burger stack using your existing PNG layers
     * - Each ingredient is a transparent plane in 3D space
     * - Stacked on Y, gently curved/tilted for depth
     * - Auto-rotates for a 3D feel
     * - Preflight checks show missing files clearly
     ***************************************************************/

    const stageEl = document.getElementById("threeStage");
    const builderEl = document.getElementById("burger-builder");
    const buildBtn  = document.getElementById("build-burger-button");
    const outputEl  = document.getElementById("burger-recipe-output");
    const stageStatus = document.getElementById("stageStatus");

    function setStatus(text) { stageStatus.textContent = "Status: " + text; }

    function showStageError(html) {
      stageEl.innerHTML = `<div class="stage-error">${html}</div>`;
    }

    function getRadioValue(name) {
      const checked = document.querySelector(`input[name="${name}"]:checked`);
      return checked ? checked.value : null;
    }
    function getCheckedValues(name) {
      return [...document.querySelectorAll(`input[name="${name}"]:checked`)].map(x => x.value);
    }
    function getConfig() {
      return {
        bun: getRadioValue("bun"),
        patty: getRadioValue("patty"),
        cheese: getCheckedValues("cheese"),
        topping: getCheckedValues("topping")
      };
    }

    // Your existing image paths (MUST match repo exactly: folder + filename casing)
    const IMG = {
      bun_bottom: "bun-bottom.png",
      bun_top: "bun-top.png",
      wrap_bottom: "lettuce-wrap-bottom.png",
      wrap_top: "lettuce-wrap-top.png",

      patty_beef: "patty-beef.png",
      patty_chicken: "patty-chicken.png",
      patty_veggie: "patty-veggie.png",

      cheese_american: "cheese-american.png",
      cheese_cheddar: "cheese-cheddar.png",
      cheese_swiss: "cheese-swiss.png",

      topping_lettuce: "topping-lettuce.png",
      topping_tomato: "topping-tomato.png",
      topping_onions: "topping-onions.png"
    };

    function configToStackKeys(cfg) {
      const stack = [];

      stack.push(cfg.bun === "lettuce-wrap" ? "wrap_bottom" : "bun_bottom");
      stack.push(`patty_${cfg.patty}`);

      // stack cheeses (multiple selections = multiple slices)
      for (const c of cfg.cheese) stack.push(`cheese_${c}`);

      // toppings in a stable order
      const toppingOrder = ["lettuce", "tomato", "onions"];
      for (const t of toppingOrder) {
        if (cfg.topping.includes(t)) stack.push(`topping_${t}`);
      }

      stack.push(cfg.bun === "lettuce-wrap" ? "wrap_top" : "bun_top");

      return stack;
    }

    // --- Hard stop if Three.js isn't available ---
    if (!window.THREE) {
      showStageError("<b>Three.js failed to load.</b><br>Check your internet/CDN access.");
      setStatus("Three.js failed");
      throw new Error("THREE missing");
    }

    // --- Create scene ---
    stageEl.innerHTML = ""; // clear "loading"
    setStatus("Creating scene…");

    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0x05070b);

    const camera = new THREE.PerspectiveCamera(40, 1, 0.1, 100);
    // A tighter camera + slightly above gives a more “product render” feel
    camera.position.set(0, 2.2, 7.2);

    const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: false });
    renderer.setPixelRatio(Math.min(window.devicePixelRatio || 1, 2));
    stageEl.appendChild(renderer.domElement);

    // Lighting (mostly affects any non-basic materials; still good for depth cues + ground)
    scene.add(new THREE.AmbientLight(0xffffff, 0.65));

    const key = new THREE.DirectionalLight(0xffffff, 0.8);
    key.position.set(4, 7, 6);
    scene.add(key);

    const fill = new THREE.DirectionalLight(0xffffff, 0.35);
    fill.position.set(-6, 3, -4);
    scene.add(fill);

    // Ground
    const ground = new THREE.Mesh(
      new THREE.PlaneGeometry(30, 30),
      new THREE.MeshStandardMaterial({ color: 0x070a10, roughness: 1 })
    );
    ground.rotation.x = -Math.PI / 2;
    ground.position.y = 0;
    scene.add(ground);

    // Burger group
    const burgerGroup = new THREE.Group();
    burgerGroup.position.set(0, 0.2, 0);
    // a slight tilt makes rotation look more 3D
    burgerGroup.rotation.x = -0.12;
    scene.add(burgerGroup);

    // Optional OrbitControls (won’t crash if missing)
    let controls = null;
    if (THREE.OrbitControls) {
      controls = new THREE.OrbitControls(camera, renderer.domElement);
      controls.enableDamping = true;
      controls.enablePan = false;
      controls.enableZoom = true;
      controls.target.set(0, 1.2, 0);
    }

    // Sizing
    function onResize() {
      const rect = stageEl.getBoundingClientRect();
      const w = Math.max(1, Math.floor(rect.width));
      const h = Math.max(1, Math.floor(rect.height));
      renderer.setSize(w, h, false);
      camera.aspect = w / h;
      camera.updateProjectionMatrix();
    }
    window.addEventListener("resize", onResize);
    onResize();

    // Textures
    const texLoader = new THREE.TextureLoader();
    const texCache = new Map();

    function loadTexture(url) {
      if (texCache.has(url)) return Promise.resolve(texCache.get(url));
      return new Promise((resolve, reject) => {
        texLoader.load(
          url,
          (t) => {
            texCache.set(url, t);
            resolve(t);
          },
          undefined,
          () => reject(new Error("Missing image: " + url))
        );
      });
    }

    // Create a plane that matches the texture aspect ratio (looks much better)
    function makePlaneForTexture(tex, targetWidth) {
      // If image is not ready, fallback to square
      const img = tex.image;
      const iw = (img && img.width) ? img.width : 512;
      const ih = (img && img.height) ? img.height : 512;

      const aspect = iw / ih;          // width / height
      const w = targetWidth;
      const h = w / aspect;

      const geo = new THREE.PlaneGeometry(w, h);

      const mat = new THREE.MeshBasicMaterial({
        map: tex,
        transparent: true,
        depthWrite: false,   // important for alpha layers
        depthTest: true,
        side: THREE.DoubleSide
      });

      return new THREE.Mesh(geo, mat);
    }

    // Preflight check: list all missing URLs clearly
    async function preflightUrls(urls) {
      const missing = [];
      for (const u of urls) {
        try { await loadTexture(u); }
        catch { missing.push(u); }
      }
      return missing;
    }

    async function rebuildBurger() {
      // Clear old
      while (burgerGroup.children.length) burgerGroup.remove(burgerGroup.children[0]);

      const cfg = getConfig();
      const keys = configToStackKeys(cfg);
      const urls = keys.map(k => IMG[k]).filter(Boolean);

      setStatus("Loading layers…");

      // Preflight so errors are clean and complete
      const missing = await preflightUrls(urls);
      if (missing.length) {
        setStatus("Missing images");
        showStageError(
          `<b>Missing image files</b><br>
           These paths did not load (case-sensitive on GitHub Pages):<br><br>
           ${missing.map(m => `• <code>${m}</code>`).join("<br>")}<br><br>
           Fix by renaming your folder/files to match exactly.`
        );
        return;
      }

      // Stack settings (tuned for nicer “render” look)
      let y = 0.75;
      const gap = 0.20;

      // Target width of each layer plane in world units
      const layerWidth = 3.8;

      for (let i = 0; i < urls.length; i++) {
        const tex = await loadTexture(urls[i]);
        const plane = makePlaneForTexture(tex, layerWidth);

        // Place layer
        plane.position.set(0, y, 0);

        // Slight curvature illusion: rotate layers a tiny bit alternating
        plane.rotation.y = (i % 2 === 0 ? 1 : -1) * 0.015;

        // Slight depth staggering prevents z-fighting and improves alpha compositing
        plane.position.z = i * 0.002;

        burgerGroup.add(plane);
        y += gap;
      }

      setStatus("Ready");
    }

    // Live updates
    builderEl.addEventListener("change", () => {
      rebuildBurger().catch((err) => {
        console.error(err);
        setStatus("Error");
        showStageError(`<b>3D Builder Error</b><br>${err.message}`);
      });
    });

    // Summary button
    buildBtn.addEventListener("click", () => {
      const cfg = getConfig();
      outputEl.innerHTML =
        `<b>Your Burger Build:</b><br>` +
        `• Bun: ${cfg.bun}<br>` +
        `• Patty: ${cfg.patty}<br>` +
        `• Cheese: ${cfg.cheese.length ? cfg.cheese.join(", ") : "None"}<br>` +
        `• Toppings: ${cfg.topping.length ? cfg.topping.join(", ") : "None"}`;
    });

    // Auto-rotate
    function animate() {
      requestAnimationFrame(animate);

      // Auto-rotate (product spin)
      burgerGroup.rotation.y += 0.006;

      if (controls) controls.update();
      renderer.render(scene, camera);
    }

    // Boot
    rebuildBurger().catch((err) => {
      console.error(err);
      setStatus("Error");
      showStageError(`<b>3D Builder Error</b><br>${err.message}`);
    });
    animate();
  </script>
</body>
</html>







